<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/static/assets/css/layui.css">
    <link rel="stylesheet" href="/static/assets/css/login.css">
    <link rel="icon" href="/favicon.ico">
    <title>管理后台</title>
</head>
<body class="login-wrap">
    <div class="login-container">
        <div class="login-form">
            <div class="input-group">
                <input type="text" id="username" class="input-field" disabled="disabled">
                <label for="username" class="input-label">
                    <span class="label-title">用户名</span>
                </label>
            </div>
			<div class="input-group">
			    <input type="text" id="sex" class="input-field" disabled="disabled">
			    <label for="username" class="input-label">
			        <span class="label-title">性别</span>
			    </label>
			</div>
			<div class="input-group">
			    <input type="text" id="age" class="input-field" disabled="disabled">
			    <label for="username" class="input-label">
			        <span class="label-title">年龄</span>
			    </label>
			</div>
			<div class="input-group">
			    <input type="text" id="address" class="input-field" disabled="disabled">
			    <label for="username" class="input-label">
			        <span class="label-title">地址</span>
			    </label>
			</div>
			<div class="input-group">
			    <input type="text" id="hoby" class="input-field" disabled="disabled">
			    <label for="username" class="input-label">
			        <span class="label-title">爱好</span>
			    </label>
			</div>
            <div class="input-group">
                <input type="text" id="money" class="input-field" disabled="disabled">
                <label for="money" class="input-label">
                    <span class="label-title">余额</span>
                </label>
            </div>      
			<div id="go">
				<button id="update" type="button" class="login-button">修改<i class="ai ai-enter"></i></button>
				<!-- <button id="go_btn" type="button" class="login-button">提交<i class="ai ai-enter"></i></button> -->
			</div>
        </div>
    </div>
</body>
<script src="/static/assets/layui.js"></script>
<script src="/static/assets/index.js" data-main="login"></script>
<script src="/static/assets/jquery.min.js"></script>
<script>
	$(function(){
		if(window.localStorage.getItem('uname'))
		{
			$.ajax({
		    type:'post',
		    url:'http://127.0.0.1:8000/user/personal',
		    data:JSON.stringify({
				'uname':window.localStorage.getItem('uname'),
				'this':'this'
		    }),
		    dataType:'json',
		    contentType:'application/json',
		    success:function(data){
		        if(data.code == 200){
		            $('#username').val(data.data.username)
		            $('#sex').val(data.data.sex)
		            $('#age').val(data.data.age)
		            $('#address').val(data.data.address)
		            $('#hoby').val(data.data.hoby)
		            $('#money').val(data.data.money)
					old_uname = data.data.username
					$('.label-title').each(function () {
						// $(this).html('')
					})
		        }
		        else{
		            alert(data.error);
		        }
		    },
		    error:function(){
		        console.log('123456');
		    },
		});
		$('#update').click(function(){
			$('#username').removeAttr('disabled')
			$('#sex').removeAttr('disabled')
			$('#age').removeAttr('disabled')
			$('#address').removeAttr('disabled')
			$('#hoby').removeAttr('disabled')
//		$('#money').removeAttr('disabled')-->
			$('#go').html('<button id="go_btn" type="button" class="login-button">提交<i class="ai ai-enter"></i></button>')
			$('#go_btn').click(function(){
			// alert(old_uname)
			$.ajax({
				type:'post',
				url:'http://127.0.0.1:8000/user/personal',
				data:JSON.stringify({
					'uname':old_uname,
					'username':$('#username').val(),
					'sex':$('#sex').val(),
					'age':$('#age').val(),
					'address':$('#address').val(),
					'hoby':$('#hoby').val(),
					'money':$('#money').val(),
				}),
				dataType:'json',
				contentType:'application/json',
				success:function(data){
					if(data.code == 200){
						alert('修改成功!');
						window.localStorage.setItem('uname',$('#username').val())
						window.localStorage.setItem('token',data.data.token)
						window.location.href = 'http://127.0.0.1:8000/user/personal';
					}
					else{
						alert(data.error);
					}
				},
				error:function(){
					console.log('123456');
				},
			});
		})
		});

		}

	});
</script>
</html>